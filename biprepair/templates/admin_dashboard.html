{% extends "admin_base.html" %}
{% block title %}Admin Panel Â· Appointments{% endblock %}
{% block admin_content %}
<section class="page-heading">
    <div>
        <p class="eyebrow">Operations</p>
        <h1>Appointments queue</h1>
        <p>Approve safe requests. Decline unsupported ones with a short note.</p>
    </div>
</section>

<section class="card">
    <form method="get" class="form-grid">
        <label>
            <span>Status filter</span>
            <select name="status" class="input-control">
                <option value="">All</option>
                {% for value, label in status_choices %}
                    <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>
                        {{ label }}
                    </option>
                {% endfor %}
            </select>
        </label>
        <button class="btn primary" type="submit">Apply</button>
    </form>
</section>

<section class="card">
    <div class="table-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Client</th>
                    <th>Device</th>
                    <th>Service</th>
                    <th>Status</th>
                    <th>Preferred schedule</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for appointment in appointments %}
                    <tr>
                        <td>{{ appointment.appointment_id }}</td>
                        <td>{{ appointment.full_name }}</td>
                        <td>{{ appointment.get_device_type_display }}</td>
                        <td>{{ appointment.service_label }}</td>
                        <td>
                            {% if appointment.status == 'approved' %}
                                <span class="status-chip status-completed">Completed</span>
                            {% else %}
                                <span class="status-chip status-{{ appointment.status }}">{{ appointment.get_status_display }}</span>
                            {% endif %}
                        </td>
                        <td>{{ appointment.preferred_datetime|date:"M d, Y h:i A" }}</td>
                        <td class="admin-actions">
                            <a href="{% url 'admin_detail' appointment.appointment_id %}">Manage</a>
                            <form id="delete-form-{{ appointment.appointment_id }}"
                                  class="admin-delete-form"
                                  method="post"
                                  action="{% url 'admin_delete_appointment' appointment.appointment_id %}">
                                {% csrf_token %}
                                <input type="hidden" name="next" value="{{ request.get_full_path }}" />
                                <button type="button"
                                        class="admin-delete-btn"
                                        data-delete-trigger
                                        data-appointment-id="{{ appointment.appointment_id }}"
                                        data-appointment-client="{{ appointment.full_name }}"
                                        data-delete-form="delete-form-{{ appointment.appointment_id }}">
                                    Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7">No appointments yet.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>

<div class="admin-modal" hidden data-delete-modal>
    <div class="admin-modal__scrim" data-delete-cancel></div>
    <div class="admin-modal__panel">
        <p class="eyebrow">Danger zone</p>
        <h3 data-delete-modal-title>Delete appointment?</h3>
        <p data-delete-modal-body>
            Are you sure you want to delete this appointment?
        </p>
        <div class="admin-modal__actions">
            <button type="button" class="btn ghost" data-delete-cancel>Keep appointment</button>
            <button type="button" class="btn danger" data-delete-confirm>Yes, delete it</button>
        </div>
    </div>
</div>
{% endblock %}
