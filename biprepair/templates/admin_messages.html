{% extends "admin_base.html" %}
{% block title %}Messages · Student-Technician Repair HUB{% endblock %}
{% block admin_content %}
<section class="page-heading">
    <div>
        <p class="eyebrow">Inbox</p>
        <h1>Client conversations</h1>
        <p>Track every Contact Admin submission without leaving the console.</p>
    </div>
</section>

<section class="admin-messages__filters card">
    <form method="get" class="filters-form">
        <label>
            <span>Search clients or topics</span>
            <input type="search" name="q" value="{{ search_query }}" placeholder="Name, email, or subject" />
        </label>
        <button class="btn primary" type="submit">Apply</button>
    </form>
</section>

<section class="card">
    {% if conversation_list %}
        <ul class="admin-message-list">
            {% for item in conversation_list %}
                <li class="admin-message">
                    <a class="admin-message__link" href="{% url 'admin_message_detail' item.id %}">
                        <header class="admin-message__header">
                            <div>
                                <p class="eyebrow">{{ item.client.full_name }} · {{ item.client.email }}</p>
                                <h3>{{ item.client.full_name }}</h3>
                                <small class="admin-message__sub">Latest: {{ item.subject|default:"Messenger conversation" }}</small>
                            </div>
                            <span class="status-chip status-{{ item.status }}">{{ item.get_status_display }}</span>
                        </header>
                        <p class="admin-message__body">{{ item.body|truncatewords:18 }}</p>
                        <footer class="admin-message__footer">
                            <div>
                                <small>Preferred: {{ item.get_preferred_contact_display }}</small>
                                <small>Updated {{ item.updated_at|date:"M j, Y · g:ia" }}</small>
                            </div>
                            <div>
                                <small>{{ item.created_at|timesince }} ago</small>
                            </div>
                        </footer>
                    </a>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <div class="empty-state">
            <p class="empty-state__title">No messages yet</p>
            <p>Clients haven’t reached out through Contact Admin. Once they do, their threads will appear here.</p>
        </div>
    {% endif %}
</section>
{% endblock %}
